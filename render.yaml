# Render Blueprint - Deploy Both Services
# Deploy: https://dashboard.render.com/blueprints

services:
  # 1. Python ML Service (Backend)
  - type: web
    name: voice-detection-ml
    env: docker
    dockerfilePath: ./python/Dockerfile
    dockerContext: .
    region: oregon
    plan: free
    healthCheckPath: /health
    envVars:
      - key: PYTHONUNBUFFERED
        value: "1"
      - key: GITHUB_REPO
        value: "Rushi4912/voice-detection-api"
      - key: RELEASE_TAG
        value: "v1.0.0-models"

  # 2. Node.js API Gateway (Frontend API - This is your submission endpoint)
  - type: web
    name: voice-detection-api
    env: node
    buildCommand: npm install && npm run build
    startCommand: npm start
    rootDir: server
    region: oregon
    plan: free
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: "production"
      - key: API_KEY
        value: "sk_test_123456789"
      - key: PYTHON_SERVICE_URL
        fromService:
          type: web
          name: voice-detection-ml
          property: hostport
      - key: LOG_LEVEL
        value: "INFO"
